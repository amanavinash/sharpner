<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body> 
 <form onsubmit="aman(event)">
     <label> Choose expenceamount</label>
     <input id='number' type="number" name="number">
     <label> Choose description</label>
     <input id='text' type="text" name="text">
     <label >choose a category </label>
     <select id='category' type="text" name="category">
         <option selected></option>
         <option value="on vocation">on vocation</option>
         <option value=" diesel"> diesel</option>
         <option value=" moviewwwdsd"> moviewwwdsd</option>
         <option value="car"> car</option>
     </select>
     <button> Add Expences </button>
 </form>
 <ul id="listOfUsers"></ul>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
   <script>
       function aman(event) {
           event.preventDefault();
           const amount = event.target.number.value;
           const description = event.target.text.value;
           const category = event.target.category.value;
           
       const obj = {
               amount,
               description,
               category,
               
           }
           const token  =  localStorage.getItem('token') ;
           axios.post("http://localhost:3000/expense/add-user", obj, { headers: {'Authorization':token}})
               .then((response) => {

                 showNewUserOnScreen(response.data.newUserDetails) 

               })
               .catch((err) => {
                   document.body.innerHTML = document.body.innerHTML + 
                   console.log(err)
               });
       }
       window.addEventListener("DOMContentLoaded", () => {
        const token  =  localStorage.getItem('token') 
           axios.get("http://localhost:3000/expense/get-user",{ headers: {'Authorization':token}  })
               .then((response) => {
                
                for (var i = 0; i < response.data.allUsers.length; i++) {
                   showNewUserOnScreen(response.data.allUsers[i])
               }
                  
               })
               .catch((error) => {
                   console.log(error)
               });


       })
       function showNewUserOnScreen(user) {
           document.getElementById('number').value = '';
           document.getElementById('text').value = '';
           document.getElementById('category').value = '';
               const parentNode = document.getElementById('listOfUsers');
               const childHTML = `<li id=${user.id}> ${user.amount}-${user.description}-${user.category}
                                        <button onclick="deleteUser('${user.id}')"> Delete Expences </button>
                                    
 </li>`
               parentNode.innerHTML = parentNode.innerHTML + childHTML;
           }
         

       function deleteUser(userId ) {
        const token  =  localStorage.getItem('token') 
         axios.delete(`http://localhost:3000/expense/delete-user/${userId}`,{ headers: {'Authorization':token}})

               .then((response) => {
                   removeUserFromScreen(userId)
               })
               .catch((error) => {
                   console.log(error)
               });
           console.log(userId);
       }
       function removeUserFromScreen(userId) {
       
               const parentNode = document.getElementById('listOfUsers');
       
               const childNodeToBeDeleted = document.getElementById(userId);
               if (childNodeToBeDeleted) {
                   parentNode.removeChild(childNodeToBeDeleted)
               }      
           
       }

 </script> 
   <button id="rzp-button1">Pay with Razorpay</button>
   <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
 <script> 
    document.getElementById('rzp-button1').onclick= async function (e){
    const token  = localStorage.getItem('token')
    
    const response= await axios.get("http://localhost:3000/purchase/premiummembership",{ headers: {'Authorization':token}  })
    console.log('order.id', response.data.order.id);
    var opinions ={
    'key': response.data.key_id,
    'order_id': response.data.order.id,
    'handler':async function(response){
    await axios.post("http://localhost:3000/purchase/updatetransactionstatus", {
    order_id:opinions.order_id,
    payment_id:response.razorpay_payment_id}, { headers: {'Authorization':token}})
                alert('you are a  Priumem User Now ') ;
    },
    };
    const rpzl = new Razorpay( opinions);
    rpzl.open();
    e.preventDefault();
    rpzl.on('payment failed',function(response){
    
    console.log(response)
    alert('something went wrong')
    });
    }
 </script> 



</script>

</body>

</html>







